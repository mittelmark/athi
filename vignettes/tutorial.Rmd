---
title: "Vignette for the functions of the athi package"
author: Detlef Groth, University of Potsdam, Germany
date: 2023-07-26
output: 
    rmarkdown::html_vignette:
        toc: true
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
include-before: |
    <style> body { max-width: 1000px; font-family: Candara, sans-serif;} </style>
    <center>[athi functions](athi-functions.html) - [athi analysis](athi-analysis.html) </center>
    
---

```{r echo=FALSE,results="hide"}
library(knitr)
```

## Introduction

Below you find example code for the package for most of the  functions  which
should illustrate on how to use them.

You first should load the package using the standard  `library`  function. All
functions are provided  within an  environment  `athi` to see what methods are
available you can use the `ls` command:

```{r}
library(athi)
ls(athi)
```

Alternatively all functions have copies using the athi-underline  prefix which
you can as well view like this:

```{r}
ls(pattern="athi_")
```

The  advantage of the  environment  athi is, that you can easily extend it by
adding  your own data and  functions  to it. It is then  possible to save this
file  as RDS and to give it to  someone  else or as a  supplement  for a paper
without the need to create a full package.

Here an example:

```{r}
athi$hello = function () { print("Hello World") }
data(iris)
athi$data_iris = iris
ls(athi)
```

You      can       save       this       extended       environment       with
`saveRDS(athi,file="athi-extended.RDS")`  and you can  load  this  environment
then on other computer using the command `athi=readRDS("athi-extened.RDS")`


## Functions 

### athi$assoc_plot

Create an association plot with Pearson residual coloring and legend.

This function updates the standard assocplot function from the graphics package 
with the ability to display residual colors. In blue and red are shown groups with 
residuals  above +4 or below -4 in light colors are shown residuals  between 2
and 4 for positive and -4 and -2 for negative  residuals.  At the bottom there
is the residual legend shown as well as the P-value for the Chisq-test and the
effect size measure Cohen's d.

Usage: *athi_assoc_plot(x,legend=TRUE,shade=TRUE,...)*

```{r fig=TRUE,fig.width=8,fig.height=6}
x <- margin.table(HairEyeColor, c(1, 2))
athi$assoc_plot(x)
```

### athi$bootstrap

Perform a resampling for the given data set and function. 

The function allows you to perform a resampling method without replacement to perform
a boostrap analysis for instance to cmpute a p-value or a confidence interval.

Usage: *athi_bootstrap(x,FUN=NULL,n=1000,...)*

```{r}
rn=rnorm(100,mean=10,sd=2)
t.test(rn)$conf.int
vals=athi$bootstrap(rn,FUN=mean)
summary(vals)
quantile(vals,c(0.025,0.975)) # 95% CI is very close
### confidence interval for spearman correlation
cor.test(swiss[,1],swiss[,2],method="spearman")
vals=athi$bootstrap(swiss[,c(1,2)],
      FUN=function(x) cor(x[,1],x[,2],method="spearman"))
summary(vals)
### insignificant as it crosses zero
quantile(vals,c(0.025,0.975)) # 95% CI shows insignifcant
```

### athi$box_plot

Visualize a mean comparison with boxplot and main statistics.

This function is plotting the standard boxplot for a numerical data against a factor variabl and adds on top the 
the main statistics, like the Cohen's d, or the Eta-squared value, the significance level and for t-tests the  
confidence interval as well.

Usage: *athi_box_plot(x,y=NULL,data=NULL,col='grey80',grid=TRUE,main=NULL,...)*

```{r fig.width=6,fig.height=4}
data(iris)
athi$box_plot(Sepal.Length ~ Species, data=iris,col=2:4)
```

### athi$cdist

Correlation  distances  between  two  vectors or for all  variable  pairs in a
matrix.

Usage: *athi_cdist(x,method="pearson",type="abs")*

```{r}
### Euclidean distance
round(dist(t(scale(iris[,1:4]))),2)
### Correlation distance
round(athi$cdist(t(iris[,1:4])),2)
round(athi$cdist(t(iris[,1:4]),method="spearman",type="square"),2)
```

## athi$chr2ord

Map characters or factors to numbers.

Create ordinal numerical variables out of character or factor variables based on a given mapping.

Usage: *athi_chr2ord(x,map)*

```{r}
status=c("never","rare","often","always")
x=sample(status,100,replace=TRUE)
x=c(NA,x,NA)
table(x,useNA='ifany')
map=c(never=0, rare=1, often=2,always=3)
table(athi$chr2ord(x,map),useNA='ifany')
```


### athi$cohensD

Effect sizes measure for difference between two means.

Calculate the effect size for the difference between two means, divided by the pooled standard deviation.

The function cohensD calculates the effect size for the difference between two means.
Due to Cohen's rule of thumb values of around 0.2 are considered to stand 
for small effects, values of around 0.5 represent medium effects and values of around 0.8 
and larger represent large effects. 

Please note that these rules of thumb are not useful for highly dependent 
outcome variables (death for instance) these rules might not be useful and as 
well lower values might be of practical relevance.

Usage: *athi_cohensD(x,g,paired=FALSE)*
 
```{r}
cohensD=athi$cohensD
set.seed(125)
data(sleep)
with(sleep,cohensD(extra,group))
x1=rnorm(100,mean=20,sd=1)
x2=rnorm(100,mean=22,sd=1)
g1=rep('A',100)
g2=rep('B',100)
### difference should be around 2SD
cohensD(c(x1,x2),as.factor(c(g1,g2)))
### biseriell correlation coefficient as alternative
### value is as well large
cor(c(x1,x2),as.numeric(as.factor(c(g1,g2))))
```

### athi$cohensW

Effect sizes measure for categorical data.

Calculate the effect size for 2x2 and larger contingency tables as well as for single variables.

The function `athi$cohensW` (omega) calculates the effect size for contingency tables. 
Due to Cohen's rule of thumb values of around 0.1 are considered to stand 
for small effects, values of around 0.3 represent medium effects and values 
above 0.5 or higher represent large effects. 

Please note that these rules of thumb are not useful for highly dependent outcome 
variables (death for instance) these rules might not be useful and as well lower
values might be of practical relevance.

Usage: *athi_cohensW(x,p=NULL)*

```{r}
data(Titanic)
### first class data only
Titanic[1,1,,]
athi$cohensW(Titanic[1,1,,])
### Data from New Eng. J. Med. 329:297-303, 1993
azt=as.table(matrix(c(76,399,129,332), byrow=TRUE,ncol=2))
rownames(azt)=c("AZT","Placebo")
colnames(azt)=c("DiseaseProgress", "NoDiseaseProgress")
azt
athi$cohensW(azt)
### number of boys (25) and girls (15) in a hospital which deviates 
### from 50/50 or 51/49 ratios
prop.table(c(25,15))
(prop.table(c(25,15))-0.5)*2
athi$cohensW(c(25,15),p=0.5)
athi$cohensW(c(25,15),p=c(0.51,0.49))
### most extrem case 40 boys and 0 girls
athi$cohensW(c(40,0),p=0.5)
athi$cohensW(c(40,0),p=c(0.51,0.49)) # max value here around 2*0.49
```

### athi$corr

Pairwise  correlations for a matrix or data frame with estimate,  p-values and
confidence intervals.

Method to determine pairwise correlations and their statistical properties.
This function is an extension to the `cor` function as it as well calculates all p-values and the confidence intervals for the
correlation coefficient.

Usage: *athi_corr(x,method='pearson',use='pairwise.complete.obs')*

```{r}
options(width=90)
data(swiss)
res=athi$corr(swiss)
ls(res)
lapply(res[1:4],round,2)
```

### athi$cor_plot

visualize a correlation with abline and main statistics.

This function is plotting the standard xy-plot for two numerical variables and adds on top the 
the main statistics, like the r-value, the confidence interval and the significance level.

Usage: *athi_cor_plot(x,y,method="pearson",col='blue',grid=TRUE,main=NULL,pch=19,...)*

```{r fig.width=6,fig.height=4}
data(swiss)
athi$cor_plot(swiss$Fertility,swiss$Agriculture,
     xlab="Fertility",ylab="Agriculture")
```

### athi$corr_plot

Visualize a correlation matrix

This function is plotting the pairwise correlations for the given
symmetric correlation matrix.

Usage: *athi_corr_plot(mt,text.lower=TRUE, text.upper=FALSE, pch=19,p.mat=NULL,alpha=0.05, cex.sym=5,cex.r=1,cex.lab=1.4,...)*

```{r fig=TRUE,fig.width=9,fig.height=6}
par(mai=rep(0.3,4))
data(swiss)
sw=swiss
colnames(sw)=abbreviate(colnames(swiss),6)
options(warn=-1) # avoid spearman warnings
cr=athi$corr(sw,method='spearman')
athi$corr_plot(cr$estimate,cex.sym=8,text.lower=TRUE,
   cex.r=1.5,p.mat=cr$p.value)
options(warn=0)
```

### athi$eta_squared

Effect sizes measure for ANOVA.

Calculate the effect size for an ANOVA or a linear model with two variables.

The function `athi$eta_squared` (omega) calculates the effect size for an ANOVA.
Cohen's rule of thumb for interpretation is: around 0.01 small, around 0.09 medium and around 0.25 or higher we have a large effect.
You can convert Eta-squared to a Pearson r coefficient by using the sqrt of eta-square.

Please note that these rules of thumb are not useful for highly dependent outcome 
variables (death for instance) these rules might not be useful and as well lower
values might be of practical relevance.

Usage: *athi_eta_squared(x,y=NULL)*
 
```{r}
data(iris)
etaSquared=athi$eta_squared
etaSquared(iris$Sepal.Length,iris$Species)
etaSquared(lm(iris$Sepal.Length ~ iris$Species))
summary(lm(iris$Sepal.Length ~ iris$Species))
etaSquared(aov(iris$Sepal.Length ~ iris$Species))
etaSquared(aov(Sepal.Length ~ Species+Sepal.Width+Petal.Length,data=iris))
```

## Table Example

```{r results="asis"}
knitr::kable(head(iris))
```

## Inline expression

The dataset iris has `r nrow(iris)` plants.

## EOF



